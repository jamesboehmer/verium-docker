#!/bin/bash

set -e
#set -x

RPCHOST="${RPCHOST:-veriumd}";
RPCPORT="${RPCPORT:-33987}";
RPCUSER="${RPCUSER:-veriumuser}";
RPCPASS="${RPCPASS:-secret}";
TMPDIR="$(mktemp -d)";
CPUMINER_CONF="/root/.cpuminer.json";

if [[ ! -f ${CPUMINER_CONF} ]]
then
	echo "Creating default ${CPUMINER_CONF}...";
	cat > "${CPUMINER_CONF}" << EOF
{
  "_comment1": "Generated by $0 at $(date)",
  "url": "http://${RPCHOST}:${RPCPORT}/",
  "user": "${RPCUSER}",
  "pass": "${RPCPASS}",
  "quiet": false,
  "debug": true,
  "retry-pause": 5
}

EOF

fi

chmod 600 "${CPUMINER_CONF}";

cpuminer --config "${CPUMINER_CONF}"

exit $?
